{% extends "_base.html" %}

{% load i18n %}

{% block title %}Donate{% endblock %}

{% block body_class %}page-donate{% endblock %}

{% block content %}
<div class="hero">
	<div class="container">
		<h1 class="title">Donate Today!</h1>

		<ul class="list-inline amount-buttons">
			<li><button class="btn-cdc btn-cdc-inverse" data-value="10">$10</button></li>
			<li><button class="btn-cdc btn-cdc-inverse" data-value="25">$25</button></li>
			<li><button class="btn-cdc btn-cdc-inverse" data-value="50">$50</button></li>
			<li><button class="btn-cdc btn-cdc-inverse" data-value="100">$100</button></li>
			<li><button class="btn-cdc btn-cdc-inverse" data-value="other">Other</button></li>
		</ul>
		<div class="amount-actual">
			<span class="dollar">$</span>
			<input type="text" class="form-control input-lg" maxlength="6">
		</div>
		<button class="btn-cdc btn-cdc-inverse btn-do-it" disabled>Do it.</button>
	</div>
</div>

<div class="container">
    <h1>{% trans "You can help" %}</h1>
    <p>CoderDojoChi is a registered non-profit organization supported entirely by...you! Please help us continue our mission by donating a small amount to our cause. Thank you! </p>
	<form id="checkout"></form>
</div>

{% endblock %}


{% block extra_script %}

<script src="https://js.braintreegateway.com/v2/braintree.js"></script>

<script>

	$(function() {

		braintree.setup("{{ braintree_token }}", "dropin", {
			container: "checkout"
		});

	
		var $donateForm = $('#donateForm'),
			$amountButtons = $('.amount-buttons:first'),
			$donateButton = $('.btn-do-it:first'),
			$donateAmount = $('#donateAmount'),
			$amountActual = $('.amount-actual:first'),
			$amountActualField = $('.form-control', $amountActual),

		amountButtonClick = function() {
			var $clicked = $(this);
			$('.active', $amountButtons).removeClass('active');
			$clicked.addClass('active');
			$donateButton.attr('disabled', false);

			if ($clicked.data('value') === 'other') {
				$amountActual.show();
				$amountActualField.focus();
			} else {
				$amountActual.hide();
			}
		},

		donateFormSubmit = function(e) {
			$donateButton.trigger('click');
		},

		donateButtonClick = function() {

			var $selectedAmountButton = $('.active', $amountButtons),
				selectedAmount = $selectedAmountButton.data('value');

			if(selectedAmount === 'other') {
				
				var customAmount = $amountActualField.val();

				if(customAmount.length){
					selectedAmount = parseInt(customAmount);
				} else {
					$amountActual.addClass('has-error');
					$amountActualField.focus();
					return false;
				}
			}


			$donateAmount.val('USD ' + selectedAmount);
			$donateForm.off('submit');
			$donateForm.submit();
		};

		$donateForm.submit(donateFormSubmit);

		$amountButtons
			.on('click', 'button', amountButtonClick);

		$donateButton
			.on('click', donateButtonClick);
	});
</script>
{% endblock %}
