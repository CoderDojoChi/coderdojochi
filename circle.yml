machine:
  python:
    version: 2.7.3
  services:
    - docker
  post:
    - curl -L https://github.com/docker/machine/releases/download/v0.5.3/docker-machine_linux-amd64 >/usr/local/bin/docker-machine && chmod +x /usr/local/bin/docker-machine && docker-machine version

dependencies:
  override:
    - docker info
    - docker build -t kand/$CIRCLE_PROJECT_REPONAME:latest -f ./resources/docker/Dockerfile .

test:
  override:
    - echo True

deployment:
  hub:
    branch: feature/docker-circleci
    commands:
      - docker login -p $DOCKER_PASSWORD -u $DOCKER_USERNAME -e $DOCKER_EMAIL
      - docker push kand/$CIRCLE_PROJECT_REPONAME:latest
      - docker-compose -f ./resources/docker/docker-compose.prod.yml kill
      - docker-compose -f ./resources/docker/docker-compose.prod.yml rm
      - docker-compose -f ./resources/docker/docker-compose.prod.yml up -d
